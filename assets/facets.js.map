{"version":3,"sources":["facets.js"],"names":["FacetFiltersForm","HTMLElement","[object Object]","super","this","onActiveFilterClick","bind","debouncedOnSubmit","debounce","event","onSubmitHandler","querySelector","addEventListener","facetWrapper","onKeyUpEscape","window","searchParams","state","searchParamsInitial","searchParamsPrev","renderPage","disable","document","querySelectorAll","forEach","element","classList","toggle","updateURLHash","sections","getSections","countContainer","getElementById","countContainerDesktop","add","section","url","location","pathname","filterDataUrl","filterData","some","renderSectionFromCache","renderSectionFromFetch","fetch","then","response","text","responseText","html","renderFilters","renderProductGridContainer","renderProductCount","find","innerHTML","DOMParser","parseFromString","count","container","containerDesktop","remove","parsedHTML","facetDetailsElements","matchesIndex","jsFilter","target","closest","undefined","dataset","index","facetsToRender","Array","from","filter","countsToRender","renderActiveFacets","renderAdditionalElements","renderCounts","selector","activeFacetsElement","toggleActiveFacets","bindEvents","source","targetElement","outerHTML","history","pushState","concat","id","preventDefault","formData","FormData","URLSearchParams","toString","currentTarget","href","indexOf","slice","search","customElements","define","setListeners","PriceRange","onRangeChange","setMinAndMaxValues","adjustToValidValues","inputs","minInput","maxInput","value","setAttribute","getAttribute","input","Number","min","max","FacetRemove"],"mappings":"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","file":"facets.js","sourcesContent":["class FacetFiltersForm extends HTMLElement {\n  constructor() {\n    super();\n    this.onActiveFilterClick = this.onActiveFilterClick.bind(this);\n\n    this.debouncedOnSubmit = debounce((event) => {\n      this.onSubmitHandler(event);\n    }, 500);\n\n    this.querySelector('form').addEventListener('input', this.debouncedOnSubmit.bind(this));\n\n    const facetWrapper = this.querySelector('#FacetsWrapperDesktop');\n    if (facetWrapper) facetWrapper.addEventListener('keyup', onKeyUpEscape);\n  }\n\n  static setListeners() {\n    const onHistoryChange = (event) => {\n      const searchParams = event.state ? event.state.searchParams : FacetFiltersForm.searchParamsInitial;\n      if (searchParams === FacetFiltersForm.searchParamsPrev) return;\n      FacetFiltersForm.renderPage(searchParams, null, false);\n    }\n    window.addEventListener('popstate', onHistoryChange);\n  }\n\n  static toggleActiveFacets(disable = true) {\n    document.querySelectorAll('.js-facet-remove').forEach((element) => {\n      element.classList.toggle('disabled', disable);\n    });\n  }\n\n  static renderPage(searchParams, event, updateURLHash = true) {\n    FacetFiltersForm.searchParamsPrev = searchParams;\n    const sections = FacetFiltersForm.getSections();\n    const countContainer = document.getElementById('ProductCount');\n    const countContainerDesktop = document.getElementById('ProductCountDesktop');\n    document.getElementById('ProductGridContainer').querySelector('.collection').classList.add('loading');\n    if (countContainer){\n      countContainer.classList.add('loading');\n    }\n    if (countContainerDesktop){\n      countContainerDesktop.classList.add('loading');\n    }\n\n    sections.forEach((section) => {\n      const url = `${window.location.pathname}?section_id=${section.section}&${searchParams}`;\n      const filterDataUrl = element => element.url === url;\n\n      FacetFiltersForm.filterData.some(filterDataUrl) ?\n        FacetFiltersForm.renderSectionFromCache(filterDataUrl, event) :\n        FacetFiltersForm.renderSectionFromFetch(url, event);\n    });\n\n    if (updateURLHash) FacetFiltersForm.updateURLHash(searchParams);\n  }\n\n  static renderSectionFromFetch(url, event) {\n    fetch(url)\n      .then(response => response.text())\n      .then((responseText) => {\n        const html = responseText;\n        FacetFiltersForm.filterData = [...FacetFiltersForm.filterData, { html, url }];\n        FacetFiltersForm.renderFilters(html, event);\n        FacetFiltersForm.renderProductGridContainer(html);\n        FacetFiltersForm.renderProductCount(html);\n      });\n  }\n\n  static renderSectionFromCache(filterDataUrl, event) {\n    const html = FacetFiltersForm.filterData.find(filterDataUrl).html;\n    FacetFiltersForm.renderFilters(html, event);\n    FacetFiltersForm.renderProductGridContainer(html);\n    FacetFiltersForm.renderProductCount(html);\n  }\n\n  static renderProductGridContainer(html) {\n    document.getElementById('ProductGridContainer').innerHTML = new DOMParser().parseFromString(html, 'text/html').getElementById('ProductGridContainer').innerHTML;\n  }\n\n  static renderProductCount(html) {\n    const count = new DOMParser().parseFromString(html, 'text/html').getElementById('ProductCount').innerHTML\n    const container = document.getElementById('ProductCount');\n    const containerDesktop = document.getElementById('ProductCountDesktop');\n    container.innerHTML = count;\n    container.classList.remove('loading');\n    if (containerDesktop) {\n      containerDesktop.innerHTML = count;\n      containerDesktop.classList.remove('loading');\n    }\n  }\n\n  static renderFilters(html, event) {\n    const parsedHTML = new DOMParser().parseFromString(html, 'text/html');\n\n    const facetDetailsElements =\n      parsedHTML.querySelectorAll('#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter');\n    const matchesIndex = (element) => {\n      const jsFilter = event ? event.target.closest('.js-filter') : undefined;\n      return jsFilter ? element.dataset.index === jsFilter.dataset.index : false;\n    }\n    const facetsToRender = Array.from(facetDetailsElements).filter(element => !matchesIndex(element));\n    const countsToRender = Array.from(facetDetailsElements).find(matchesIndex);\n\n    facetsToRender.forEach((element) => {\n      document.querySelector(`.js-filter[data-index=\"${element.dataset.index}\"]`).innerHTML = element.innerHTML;\n    });\n\n    FacetFiltersForm.renderActiveFacets(parsedHTML);\n    FacetFiltersForm.renderAdditionalElements(parsedHTML);\n\n    if (countsToRender) FacetFiltersForm.renderCounts(countsToRender, event.target.closest('.js-filter'));\n  }\n\n  static renderActiveFacets(html) {\n    const activeFacetElementSelectors = ['.active-facets-mobile', '.active-facets-desktop'];\n\n    activeFacetElementSelectors.forEach((selector) => {\n      const activeFacetsElement = html.querySelector(selector);\n      if (!activeFacetsElement) return;\n      document.querySelector(selector).innerHTML = activeFacetsElement.innerHTML;\n    })\n\n    FacetFiltersForm.toggleActiveFacets(false);\n  }\n\n  static renderAdditionalElements(html) {\n    const mobileElementSelectors = ['.mobile-facets__open', '.mobile-facets__count', '.sorting'];\n\n    mobileElementSelectors.forEach((selector) => {\n      if (!html.querySelector(selector)) return;\n      document.querySelector(selector).innerHTML = html.querySelector(selector).innerHTML;\n    });\n\n    document.getElementById('FacetFiltersFormMobile').closest('menu-drawer').bindEvents();\n  }\n\n  static renderCounts(source, target) {\n    const targetElement = target.querySelector('.facets__selected');\n    const sourceElement = source.querySelector('.facets__selected');\n\n    if (sourceElement && targetElement) {\n      target.querySelector('.facets__selected').outerHTML = source.querySelector('.facets__selected').outerHTML;\n    }\n  }\n\n  static updateURLHash(searchParams) {\n    history.pushState({ searchParams }, '', `${window.location.pathname}${searchParams && '?'.concat(searchParams)}`);\n  }\n\n  static getSections() {\n    return [\n      {\n        section: document.getElementById('product-grid').dataset.id,\n      }\n    ]\n  }\n\n  onSubmitHandler(event) {\n    event.preventDefault();\n    const formData = new FormData(event.target.closest('form'));\n    const searchParams = new URLSearchParams(formData).toString();\n    FacetFiltersForm.renderPage(searchParams, event);\n  }\n\n  onActiveFilterClick(event) {\n    event.preventDefault();\n    FacetFiltersForm.toggleActiveFacets();\n    const url = event.currentTarget.href.indexOf('?') == -1 ? '' : event.currentTarget.href.slice(event.currentTarget.href.indexOf('?') + 1);\n    FacetFiltersForm.renderPage(url);\n  }\n}\n\nFacetFiltersForm.filterData = [];\nFacetFiltersForm.searchParamsInitial = window.location.search.slice(1);\nFacetFiltersForm.searchParamsPrev = window.location.search.slice(1);\ncustomElements.define('facet-filters-form', FacetFiltersForm);\nFacetFiltersForm.setListeners();\n\nclass PriceRange extends HTMLElement {\n  constructor() {\n    super();\n    this.querySelectorAll('input')\n      .forEach(element => element.addEventListener('change', this.onRangeChange.bind(this)));\n\n    this.setMinAndMaxValues();\n  }\n\n  onRangeChange(event) {\n    this.adjustToValidValues(event.currentTarget);\n    this.setMinAndMaxValues();\n  }\n\n  setMinAndMaxValues() {\n    const inputs = this.querySelectorAll('input');\n    const minInput = inputs[0];\n    const maxInput = inputs[1];\n    if (maxInput.value) minInput.setAttribute('max', maxInput.value);\n    if (minInput.value) maxInput.setAttribute('min', minInput.value);\n    if (minInput.value === '') maxInput.setAttribute('min', 0);\n    if (maxInput.value === '') minInput.setAttribute('max', maxInput.getAttribute('max'));\n  }\n\n  adjustToValidValues(input) {\n    const value = Number(input.value);\n    const min = Number(input.getAttribute('min'));\n    const max = Number(input.getAttribute('max'));\n\n    if (value < min) input.value = min;\n    if (value > max) input.value = max;\n  }\n}\n\ncustomElements.define('price-range', PriceRange);\n\nclass FacetRemove extends HTMLElement {\n  constructor() {\n    super();\n    this.querySelector('a').addEventListener('click', (event) => {\n      event.preventDefault();\n      const form = this.closest('facet-filters-form') || document.querySelector('facet-filters-form');\n      form.onActiveFilterClick(event);\n    });\n  }\n}\n\ncustomElements.define('facet-remove', FacetRemove);\n"]}